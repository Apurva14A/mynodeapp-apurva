# name: mynodeappworkflow using github actions
# on: push

# jobs:
#   Deploymentjob:
#     runs-on: ubuntu-latest
#     name: build example and deploy to minikube
#     steps:
#     - uses: actions/checkout@v2
#     - name: Start minikube
#       uses: medyagh/setup-minikube@master
#     - name: Try the cluster !
#       run: kubectl get pods -A
#     - name: Build image
#       run: |
#         export SHELL=/bin/bash
#         eval $(minikube -p minikube docker-env)
#         docker build . -t kundankkkrishna/newapp:latest
#         echo -n "verifying images:"
#         docker images        
#     - name: Deploy to minikube
#       run:
#         kubectl apply -f kube
#     - name: Test service URLs
#       run: |
#         minikube service list
#         minikube service mynewservice --url
#         echo "------------------opening the service------------------"
#         curl $(minikube service myservice --url)

name: Build and Deploy the application
on:
  - push
jobs:
  job1:
    runs-on: ubuntu-latest
    name: setup and deploy
    steps:
      - name: start minikube
        id: minikube
        uses: medyagh/setup-minikube@latest
      # now you can run kubectl to see the pods in the cluster
      - name: kubectl
        run: kubectl get pods -A
      - name: Buil image
        run: docker build ./Dockerfile -t kundankkkrishna/NodeApp:latest
      - name: Deploy to cluster
        run: kubectl apply -f kube
      - name: Accessing the service
        run: |
            minikube service list
            minikube service NodeService --url
            echo "launching the service"
            curl $(minikube service NodeService --url )
